<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-BoldItalic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Generating Qrcodes With Zxing | Lukas Knuth // Developer</title><link rel=canonical href=https://lknuth.dev/writings/generating_qrcodes_with_zxing/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Generating Qrcodes With Zxing"><meta property="og:description" content="About how to use the ZXing library to generate QR-Codes on Android"><meta property="og:type" content="article"><meta property="og:url" content="https://lknuth.dev/writings/generating_qrcodes_with_zxing/"><meta property="article:section" content="writings"><meta property="article:published_time" content="2013-08-25T16:00:11+01:00"><meta property="article:modified_time" content="2013-08-25T16:00:11+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Generating Qrcodes With Zxing"><meta name=twitter:description content="About how to use the ZXing library to generate QR-Codes on Android"><link rel=stylesheet href=https://lknuth.dev/css/styles.0928263258ff48c63941ab9229aa210f361bc2867bf796849213c3220a0bd80f289f2e9ab7e3c190bf9912da983ec5fc0ad96975a429cbad0a8a07d379a4ace9.css integrity="sha512-CSgmMlj/SMY5QauSKaohDzYbwoZ795aEkhPDIgoL2A8ony6at+PBkL+ZEtqYPsX8CtlpdaQpy60KigfTeaSs6Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://lknuth.dev/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://lknuth.dev/><div id=logo style=background-image:url(https://lknuth.dev/images/logo.png)></div><div id=title><h1>Lukas Knuth // Developer</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/writings>Writings</a></li><li><a href=/about>About</a></li><li><a href=/cv>CV</a></li><li><a href=/imprint>Imprint</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Generating Qrcodes With Zxing</h1><div class=meta><div class=postdate><time datetime="2013-08-25 16:00:11 +0100 +0100" itemprop=datePublished>2013-08-25</time></div></div></header><div class=content itemprop=articleBody><p>When it comes to reading QR-codes, most Android applications use the <a href=https://github.com/zxing/zxing>ZXing library</a>. It&rsquo;s capabilities and ease of use when <em>reading</em> QR-Codes is already known, but ZXing can also <em>generate</em> QR-Codes.</p><p>Sadly, a lack of documentation makes it pretty hard to dive into this topic, so this article aims to provide a simple starting point.</p><h2 id=integration-choices>Integration choices</h2><p>There are two ways to integrate ZXing in your application: by using Intents or as a library.</p><p>Using the Intent integration makes development easier, since it&rsquo;s less work. The downside to that is, that <strong>the <a href="https://play.google.com/store/apps/details?id=com.google.zxing.client.android">&ldquo;Barcode Scanner&rdquo; application</a> must be installed</strong> on the device. The integration-module will automatically prompt the user to install the application, if it&rsquo;s not already installed, but still this involves manual interaction and might not be what you want.</p><p>The library integration is a little more complicated, but <strong>does not require any third-party applications</strong> to be installed on the device. It&rsquo;s also not really documented, so you&rsquo;ll have to do some digging around and source-reading if you want to do something custom.</p><p>We&rsquo;ll be focusing on the library integration in this article.</p><h3 id=intent-integration>Intent integration</h3><p>When you decide to use Intents, all you have to do is add the <code>android-integration</code> module (<a href=https://mvnrepository.com/artifact/com.google.zxing/android-integration>Maven repository</a>) to your Android project and use the <code>IntentIntegrator</code>-class:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>IntentIntegrator integrator <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> IntentIntegrator<span style=color:#fe8019>(</span>AnActivity<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>this</span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>integrator<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>shareText</span><span style=color:#fe8019>(</span><span style=color:#b8bb26>&#34;http://codeisland.org&#34;</span><span style=color:#fe8019>);</span>
</span></span></code></pre></div><p>And that&rsquo;s really all there is to it. The <a href=https://github.com/zxing/zxing/blob/c062955c841fd074bfaa42bafeb65b514d4c72fc/android-integration/src/main/java/com/google/zxing/integration/android/IntentIntegrator.java#LL462C8-L462C8><code>shareText(CharSequence)</code>-method</a> will <strong>start an Activity of the &ldquo;Barcode Scanner&rdquo; application</strong> to show the generated barcode. If the application could not be found, it will prompt the user to install it.</p><p>This is a very fast and simple way to integrate this in your application. But if you want to show the generated QR-Code in your own <code>ImageView</code>, you&rsquo;ll have to go with the&mldr;</p><h3 id=library-integration>Library integration</h3><p>If something more customizable is needed, choose the library integration. Next to the <code>android-integration</code> module from before, this time we&rsquo;ll also need the <code>core</code> module (<a href=https://mvnrepository.com/artifact/com.google.zxing/android-core>Maven repository</a>). Both these go into androids <code>libs/</code>-directory (or you simply use Maven).</p><p>Encoding a String into a QR-Code is <em>almost</em> straightforward with the <a href=https://github.com/zxing/zxing/blob/c062955c841fd074bfaa42bafeb65b514d4c72fc/core/src/main/java/com/google/zxing/Writer.java#L40><code>QRCodeWriter.encode(String, BarcodeFormat, int, int)</code>-method</a>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>QRCodeWriter writer <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> QRCodeWriter<span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>try</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    BitMatrix matrix <span style=color:#fe8019>=</span> writer<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>encode</span><span style=color:#fe8019>(</span>
</span></span><span style=display:flex><span>        <span style=color:#b8bb26>&#34;http://lknuth.dev&#34;</span><span style=color:#fe8019>,</span> BarcodeFormat<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>QR_CODE</span><span style=color:#fe8019>,</span> <span style=color:#d3869b>400</span><span style=color:#fe8019>,</span> <span style=color:#d3869b>400</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// Now what??
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span><span style=color:#fe8019>}</span> <span style=color:#fe8019>catch</span> <span style=color:#fe8019>(</span>WriterException e<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    e<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>printStackTrace</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span>
</span></span></code></pre></div><p>The data (in this example, the URL) is now encoded into a <code>BitMatrix</code>. But how do we get the matrix to show on-screen?</p><h2 id=how-not-to-do-it>How <strong>not</strong> to do it</h2><p>It&rsquo;s <a href=https://groups.google.com/d/msg/zxing/-LjwQAykQ4M/KsONovYDBIUJ>sometimes</a> <a href=http://stackoverflow.com/q/10090797/717341>suggested</a> to simply use the <code>javase</code> module and it&rsquo;s <a href=https://github.com/zxing/zxing/blob/master/javase/src/main/java/com/google/zxing/client/j2se/MatrixToImageWriter.java><code>MatrixToImageWriter</code>-class</a>. However, <strong>this will not work on Android</strong>, since it does not have the <code>BufferedImage</code>-class in it&rsquo;s Java implementation!</p><p>Executing the code will throw a <code>ClassNotFoundException</code> at runtime:</p><pre><code>ERROR/AndroidRuntime(xxx): java.lang.NoClassDefFoundError: javax.imageio.ImageIO
</code></pre><p>Using the <code>MatrixToImageWriter</code> to write the matrix to a file and decode it via <code>BitmapFactory</code> does <strong>also not work</strong>, since this method uses a <code>BufferedImage</code> and the <code>ImageIO</code>-class internally. Both of which are <strong>not available in Android</strong>.</p><h2 id=generating-an-android-bitmap>Generating an Android-Bitmap</h2><p>The alternative to a <code>BufferedImage</code> on Android is to use a <code>Bitmap</code>, which is Androids &ldquo;replacement&rdquo; class. It offers almost the same methods as the <code>BufferedImage</code>, so migration of the <code>toBufferedImage()</code>-methods is pretty easy. The &ldquo;Barcode Scanner&rdquo; application uses a <a href=https://github.com/zxing/zxing/blob/c062955c841fd074bfaa42bafeb65b514d4c72fc/android/src/com/google/zxing/client/android/encode/QRCodeEncoder.java#L329>similar approach</a>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#928374;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>* Writes the given Matrix on a new Bitmap object.
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>* @param matrix the matrix to write.
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>* @return the new {@link Bitmap}-object.
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>*/</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>public</span> <span style=color:#fe8019>static</span> Bitmap <span style=color:#fabd2f>toBitmap</span><span style=color:#fe8019>(</span>BitMatrix matrix<span style=color:#fe8019>){</span>
</span></span><span style=display:flex><span>    <span style=color:#fabd2f>int</span> height <span style=color:#fe8019>=</span> matrix<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>getHeight</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span>    <span style=color:#fabd2f>int</span> width <span style=color:#fe8019>=</span> matrix<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>getWidth</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span>    Bitmap bmp <span style=color:#fe8019>=</span> Bitmap<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>createBitmap</span><span style=color:#fe8019>(</span>width<span style=color:#fe8019>,</span> height<span style=color:#fe8019>,</span> Bitmap<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>Config</span><span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>RGB_565</span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>for</span> <span style=color:#fe8019>(</span><span style=color:#fabd2f>int</span> x <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span><span style=color:#fe8019>;</span> x <span style=color:#fe8019>&lt;</span> width<span style=color:#fe8019>;</span> x<span style=color:#fe8019>++){</span>
</span></span><span style=display:flex><span>        <span style=color:#fe8019>for</span> <span style=color:#fe8019>(</span><span style=color:#fabd2f>int</span> y <span style=color:#fe8019>=</span> <span style=color:#d3869b>0</span><span style=color:#fe8019>;</span> y <span style=color:#fe8019>&lt;</span> height<span style=color:#fe8019>;</span> y<span style=color:#fe8019>++){</span>
</span></span><span style=display:flex><span>            bmp<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>setPixel</span><span style=color:#fe8019>(</span>x<span style=color:#fe8019>,</span> y<span style=color:#fe8019>,</span> matrix<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>get</span><span style=color:#fe8019>(</span>x<span style=color:#fe8019>,</span>y<span style=color:#fe8019>)</span> <span style=color:#fe8019>?</span> Color<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>BLACK</span> <span style=color:#fe8019>:</span> Color<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>WHITE</span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>        <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>return</span> bmp<span style=color:#fe8019>;</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span>
</span></span></code></pre></div><p>This is a very simple and straightforward port of the <code>toBufferedImage()</code>-method from the <code>javase</code> module. The code in the ZXing application actually does a lot more than that, but I have found that this works fine as well.</p><p>A noticeable difference between the two implementations is, that I use <code>Bitmap.Config.RGB_565</code> instead of <code>Bitmap.Config.ARGB_8888</code>. The <a href=http://developer.android.com/reference/android/graphics/Bitmap.Config.html>docs say</a>:</p><blockquote><ul><li><code>ARGB_8888</code> Each pixel is stored on <strong>4 bytes</strong>.</li><li><code>RGB_565</code> Each pixel is stored on <strong>2 bytes</strong> and only the RGB channels are encoded [&mldr;]</li></ul></blockquote><p>Since we&rsquo;re showing an all black & white image and there are <em>only</em> &ldquo;rough edges&rdquo;, the <strong>quality will not decrease, but the memory-footprint will</strong>.</p><p>The generated <code>Bitmap</code>-object can now be shown using <a href=http://developer.android.com/reference/android/widget/ImageView.html#setImageBitmap(android.graphics.Bitmap)><code>ImageView.setImageBitmap(Bitmap)</code></a>.</p><h3 id=storing-the-bitmap>Storing the Bitmap</h3><p>To save the <code>Bitmap</code>-object as a image-file, use the <a href=http://developer.android.com/reference/android/graphics/Bitmap.html#compress%28android.graphics.Bitmap.CompressFormat,%20int,%20java.io.OutputStream%29><code>Bitmap.compress(Bitmap.CompressFormat, int, OutputStream)</code>-method</a>:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>File sdcard <span style=color:#fe8019>=</span> Environment<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>getExternalStorageDirectory</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span>FileOutputStream out <span style=color:#fe8019>=</span> <span style=color:#fe8019>null</span><span style=color:#fe8019>;</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>try</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    out <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> FileOutputStream<span style=color:#fe8019>(</span><span style=color:#fe8019>new</span> File<span style=color:#fe8019>(</span>sdcard<span style=color:#fe8019>,</span> <span style=color:#b8bb26>&#34;qrcode.jpg&#34;</span><span style=color:#fe8019>));</span>
</span></span><span style=display:flex><span>    <span style=color:#fabd2f>boolean</span> success <span style=color:#fe8019>=</span> qrcode_bmp<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>compress</span><span style=color:#fe8019>(</span>Bitmap<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>CompressFormat</span><span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>JPEG</span><span style=color:#fe8019>,</span> <span style=color:#d3869b>100</span><span style=color:#fe8019>,</span> out<span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>if</span> <span style=color:#fe8019>(</span>success<span style=color:#fe8019>){</span>
</span></span><span style=display:flex><span>        <span style=color:#928374;font-style:italic>// Successfully saved!
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#fe8019>}</span> <span style=color:#fe8019>else</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        <span style=color:#928374;font-style:italic>// ... or not.
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span> <span style=color:#fe8019>catch</span> <span style=color:#fe8019>(</span>FileNotFoundException e<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    e<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>printStackTrace</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span> <span style=color:#fe8019>finally</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>if</span> <span style=color:#fe8019>(</span>out <span style=color:#fe8019>!=</span> <span style=color:#fe8019>null</span><span style=color:#fe8019>)</span> <span style=color:#fe8019>try</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        out<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>close</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>}</span> <span style=color:#fe8019>catch</span> <span style=color:#fe8019>(</span>IOException e<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        e<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>printStackTrace</span><span style=color:#fe8019>();</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span>
</span></span></code></pre></div><p>This will store the <code>Bitmap</code>-instance <code>qrcode_bmp</code> to the SD-Card&rsquo;s root folder, using the given filename.</p><p>Note that in a real-live implementation, you&rsquo;d also need to check the SD-Card&rsquo;s state and ensure that it&rsquo;s writable. Note also, that you&rsquo;ll have to declare the use of the <code>android.permission.WRITE_EXTERNAL_STORAGE</code>-permission in your manifest-file.</p><h2 id=conclusion>Conclusion</h2><ul><li>For fast integration, use the <code>android-integration</code> module and it&rsquo;s <code>shareText(CharSequence)</code>-method.</li><li>For maximum customization, create a <code>BitMatrix</code> and convert it into a <code>Bitmap</code></li><li>The <code>javase</code> module will not work, because <strong>Android does not offer</strong> the <code>BufferedImage</code>-class, nor does it offer <code>ImageIO</code>!</li></ul></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2023 Lukas Knuth</div><div class=footer-right><nav><ul><li><a href=/writings>Writings</a></li><li><a href=/about>About</a></li><li><a href=/cv>CV</a></li><li><a href=/imprint>Imprint</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>