<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-BoldItalic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Italic.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/iAWriterQuattro/iAWriterQuattroS-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>TTS and Usability | Lukas Knuth // Developer</title><link rel=canonical href=https://lknuth.dev/writings/tts_and_usability/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="TTS and Usability"><meta property="og:description" content="An introduction to TTS on Android"><meta property="og:type" content="article"><meta property="og:url" content="https://lknuth.dev/writings/tts_and_usability/"><meta property="article:section" content="writings"><meta property="article:published_time" content="2014-06-13T16:02:43+01:00"><meta property="article:modified_time" content="2014-06-13T16:02:43+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="TTS and Usability"><meta name=twitter:description content="An introduction to TTS on Android"><link rel=stylesheet href=https://lknuth.dev/css/styles.c80037fe069dacf3e7d215521d1844203a2c7d5d6638afbbbd90798790d40182a5712b247ed5969fa7b0440fd20225fee106d6233729d4fc1e4381fd6b36fd14.css integrity="sha512-yAA3/gadrPPn0hVSHRhEIDosfV1mOK+7vZB5h5DUAYKlcSskftWWn6ewRA/SAiX+4QbWIzcp1PweQ4H9azb9FA=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://lknuth.dev/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://lknuth.dev/><div id=logo style=background-image:url(https://lknuth.dev/images/logo.png)></div><div id=title><h1>Lukas Knuth // Developer</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/writings>Writings</a></li><li><a href=/about>About</a></li><li><a href=/imprint>Imprint</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><p>There are limited yet very legit use-cases for Text to Speech engines in your application.</p><p>An example for such a case is an application that has focus and is doing its thing, but doesn&rsquo;t require physical interaction with the device. These applications might still want to update the user regularly, without touching or looking at the device. An example of such an application is a Navigation-app or my own <a href=https://github.com/LukasKnuth/bike-track>BikeTrack</a>.</p><h2 id=making-android-talk>Making Android talk</h2><p>Android exposes it&rsquo;s Text to Speech abilities via the <code>TextToSpeech</code>-class since API Level 4 (Android 1.6), so it should be available on all devices.</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>TextToSpeech tts <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> TextToSpeech<span style=color:#fe8019>(</span>context<span style=color:#fe8019>,</span> <span style=color:#fe8019>new</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>OnInitListener</span><span style=color:#fe8019>()</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#fe8019>public</span> <span style=color:#fabd2f>void</span> <span style=color:#fabd2f>onInit</span><span style=color:#fe8019>(</span><span style=color:#fabd2f>int</span> status<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        <span style=color:#fe8019>if</span> <span style=color:#fe8019>(</span>status <span style=color:#fe8019>==</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>SUCCESS</span><span style=color:#fe8019>){</span>
</span></span><span style=display:flex><span>            <span style=color:#928374;font-style:italic>// Start talking...
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>        <span style=color:#fe8019>}</span> <span style=color:#fe8019>else</span> <span style=color:#fe8019>if</span> <span style=color:#fe8019>(</span>status <span style=color:#fe8019>==</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>ERROR</span><span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>            <span style=color:#928374;font-style:italic>// Couldn&#39;t initialize TTS service
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>        <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>});</span>
</span></span></code></pre></div><p>This example is straightforward enough, except for the <code>OnInitListener</code>-part: Starting the TTS service and connecting to it might take some time. Therefore, we need some sort of callback to tell us when initialization is done.</p><p>What that means for our code is, that the following won&rsquo;t work:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>TextToSpeech tts <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> TextToSpeech<span style=color:#fe8019>(</span>context<span style=color:#fe8019>,</span> <span style=color:#fe8019>new</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>OnInitListener</span><span style=color:#fe8019>()</span> <span style=color:#fe8019>{...});</span>
</span></span><span style=display:flex><span><span style=color:#fabd2f>int</span> result <span style=color:#fe8019>=</span> tts<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>speak</span><span style=color:#fe8019>(</span><span style=color:#b8bb26>&#34;Testing&#34;</span><span style=color:#fe8019>,</span> <span style=color:#fe8019>...);</span>
</span></span></code></pre></div><p>If <code>speak()</code> is called directly after the constructor returns, the service might not be started, so we&rsquo;re not able to speak yet.</p><h3 id=silence-before-initialization>Silence before initialization</h3><p>If we consult the Android Documentation on the <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#speak%28java.lang.String,%20int,%20java.util.HashMap%3Cjava.lang.String,%20java.lang.String%3E%29><code>speak()</code>-method</a>, it tells us that:</p><blockquote><p>[&mldr;] This method is asynchronous, i.e. <strong>the method just adds the request to the queue of TTS requests and then returns</strong>. The synthesis might not have finished (or even started!) at the time when this method returns.</p><p>Returns: <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#ERROR><code>ERROR</code></a> or <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#SUCCESS><code>SUCCESS</code></a> <strong>of <u>queuing</u> the speak operation</strong>.</p></blockquote><p>So we told the TTS service to <em>queue</em> this speak operation, but if the service is not yet initialized, it won&rsquo;t do so! If we check the return value, we&rsquo;ll see that queueing failed.</p><p>So, adding speak-operations to the TTS before it&rsquo;s done won&rsquo;t actually just wait until it&rsquo;s initialized and then process them, <strong>they&rsquo;ll be discarded</strong> instead.</p><h3 id=initialization-might-fail>Initialization might fail</h3><p>The biggest problem with Androids Documentation on Text to Speech is, that it&rsquo;s not really clear under which circumstances initialization will fail, or what will happen if we try to use it, even if initialization failed.</p><p>By looking at the code, I could gather the following:</p><ul><li><a href=http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/2.3.2_r1/android/speech/tts/TextToSpeech.java#TextToSpeech.initTts%28%29>Older versions</a> (API Levels 4 (Android 1.6) to 9 (Android 2.3.2)) don&rsquo;t ever return <code>FAILED</code>. They simply don&rsquo;t handle the failure.</li><li>On newer versions (since API Level 14 (Android 4.0.1)) it&rsquo;s a little more complicated:<ol><li>First, try the supplied engine (supplying an engine to use is optional)&mldr;</li><li>then, try the default engine (returned by <code>getDefaultEngine()</code>) as a fallback (This can be deactivated since API Level 16 (Android 4.1.1))&mldr;</li><li>lastly, try the engine with the &ldquo;highest ranking&rdquo;, which will <a href=http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.4.2_r1/android/speech/tts/TtsEngines.java#TtsEngines.getHighestRankedEngineName%28%29><em>currently</em></a> just fall back to the first engine, if it shipped with the system.</li></ol></li></ul><p>In general: When <code>bindService()</code> returned <code>false</code> (that is, if we couldn&rsquo;t bind to the engine service) for all considered engines, a device with API Level 10 (Android 2.3.3) or higher will give you an <code>ERROR</code>-status.</p><p>That said, no implementation of <code>TextToSpeech</code> will throw exceptions or errors if you call <code>speak()</code> or <code>synthesizeToFile()</code> on them, when they&rsquo;re not completely initialized or failed to initialize. They&rsquo;ll fail gracefully and Log the error to LogCat.</p><h2 id=talk-to-me>Talk to me</h2><p>When the Service is successfully (and completely) initialized, meaning the <code>OnInitListener.onInit(status)</code>-method has been called with <code>SUCCESS</code> as the status, the service is ready and can be used.</p><p>Making the engine speak is pretty straight forward, so reading either the documentation on <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#speak%28java.lang.String,%20int,%20java.util.HashMap%3Cjava.lang.String,%20java.lang.String%3E%29><code>speak(String, int, HashMap)</code></a> or <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#synthesizeToFile%28java.lang.String,%20java.util.HashMap%3Cjava.lang.String,%20java.lang.String%3E,%20java.lang.String%29><code>synthesizeToFile(String, int, HashMap)</code></a> will get you there.</p><p>Instead, let us talk about <em>when</em> to speak and when to just shut up.</p><h3 id=silence-is-golden-sometimes>Silence is golden. <em>Sometimes</em></h3><p>&ldquo;Don&rsquo;t annoy the user&rdquo; is a good principal in general, but with Text to Speech it&rsquo;s even more important. Here are a few general rules:</p><ul><li>Allow users to deactivate TTS completely.</li><li>If you find yourself adding a lot of spoken updates to your application, try grouping all of them into levels of verbosity and let the user choose a level.</li><li>Be adaptive with the current playback</li><li>Keep spoken messages short</li></ul><p>As a general advice, take into consideration that you can not just quickly skim a spoken update or just stop reading once you have the relevant information, like you can with text. Also, you can&rsquo;t highlight things when speaking (at least not as clearly as with text), so <strong>keep the messages short and to the point</strong>.</p><h3 id=talking-the-adaptive-way>Talking, the adaptive way</h3><p>By default, when you call the <code>speak()</code>-method, the text will be spoken on the same stream that most applications use for playback (for example games or the music player). Therefore, if the user is playing music on his device, TTS will just &ldquo;talk over it&rdquo;, making it hard to understand the spoken text.</p><p>In his excellent presentation <a href=http://youtu.be/twmuBbC_oB8>&ldquo;Android Protips&rdquo;</a> from Google I/O 2011, Reto Meier talks about making applications &ldquo;adaptive&rdquo; (the part relevant to TTS starts at around <a href="http://youtu.be/twmuBbC_oB8?t=45m">45:00</a>): By requesting audio focus for a short time (in which we&rsquo;ll speak via TTS), we can pause everything that&rsquo;s on the stream or lower the streams volume (called &ldquo;ducking&rdquo;), so that the user can hear what&rsquo;s being said.</p><p>Here is a short example that <em>asks</em> the apps currently using the music stream to duck for a short while, so we can talk to the user:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#928374;font-style:italic>// -- Setup (just need to do this once) --
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>// Get access to the AudioManager:
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>AudioManager am <span style=color:#fe8019>=</span> <span style=color:#fe8019>(</span>AudioManager<span style=color:#fe8019>)</span> context<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>getSystemService</span><span style=color:#fe8019>(</span>Context<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>AUDIO_SERVICE</span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>AudioManager<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>OnAudioFocusChangeListener</span> afl <span style=color:#fe8019>=</span> <span style=color:#fe8019>new</span> AudioManager<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>OnAudioFocusChangeListener</span><span style=color:#fe8019>()</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#fe8019>public</span> <span style=color:#fabd2f>void</span> <span style=color:#fabd2f>onAudioFocusChange</span><span style=color:#fe8019>(</span><span style=color:#fabd2f>int</span> focusChange<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        <span style=color:#928374;font-style:italic>// Specify how YOUR app will handle audio-focus loss (optional)
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>};</span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>// We need to abandon the audio-focus as soon as we&#39;re done talking:
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>tts<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>setOnUtteranceCompletedListener</span><span style=color:#fe8019>(</span><span style=color:#fe8019>new</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>OnUtteranceCompletedListener</span><span style=color:#fe8019>()</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#fe8019>public</span> <span style=color:#fabd2f>void</span> <span style=color:#fabd2f>onUtteranceCompleted</span><span style=color:#fe8019>(</span>String s<span style=color:#fe8019>)</span> <span style=color:#fe8019>{</span>
</span></span><span style=display:flex><span>        am<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>abandonAudioFocus</span><span style=color:#fe8019>(</span>afl<span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span>    <span style=color:#fe8019>}</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>// Ask others to lower their volume for a short time, while we&#39;re talking:
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span><span style=color:#fabd2f>int</span> focus_res <span style=color:#fe8019>=</span> am<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>requestAudioFocus</span><span style=color:#fe8019>(</span>
</span></span><span style=display:flex><span>        afl<span style=color:#fe8019>,</span> AudioManager<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>STREAM_MUSIC</span><span style=color:#fe8019>,</span> AudioManager<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic>// Talk:
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span><span style=color:#fe8019>if</span> <span style=color:#fe8019>(</span>focus_res <span style=color:#fe8019>==</span> AudioManager<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>AUDIOFOCUS_REQUEST_GRANTED</span><span style=color:#fe8019>){</span>
</span></span><span style=display:flex><span>    tts<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>speak</span><span style=color:#fe8019>(</span>text<span style=color:#fe8019>,</span> TextToSpeech<span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>QUEUE_ADD</span><span style=color:#fe8019>,</span> <span style=color:#fe8019>this</span><span style=color:#fe8019>.</span><span style=color:#b8bb26;font-weight:700>tts_params</span><span style=color:#fe8019>);</span>
</span></span><span style=display:flex><span><span style=color:#fe8019>}</span>
</span></span></code></pre></div><p>Now, when we want to talk to the user, no other (if any) currently playing applications should interfere. Depending on how important our message is, we can change the way we want the <code>AudioManager</code> to behave:</p><ul><li>Use <a href=http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN><code>AUDIOFOCUS_GAIN</code></a> if we request focus (will pause other applications) for an unspecific period of time (but not short).</li><li>Use <a href=http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN_TRANSIENT><code>AUDIOFOCUS_GAIN_TRANSIENT</code></a> to pause other applications for a short period of time, or</li><li>use <a href=http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK><code>AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK</code></a> if it&rsquo;s something short and other applications may lower their volume for that period (this might indicate, that this message is not <em>critically</em> important).</li></ul><p><strong>NOTE</strong>: By requesting the audio focus we <em>ask</em> other applications to pause/lower their volume, <strong>they have no obligations to do so</strong>. For example, requesting transient focus with ducking might work as expected for one media player (e.g. &ldquo;Google Play Music&rdquo;) but differently for another (the HTC standard music player just pauses for the time).</p><p>We can set this behavior for our own application by reacting to audio-focus changes in the <code>OnAudioFocusChangeListener</code> (as shown in the presentation).</p><p>A decent, but not complete example of a wrapper that handles all these things can be found <a href=https://gist.github.com/LukasKnuth/0c0d17b343483d25aca2>here</a>.</p><h2 id=cleaning-up>Cleaning up</h2><p>It&rsquo;s important to call <a href=http://developer.android.com/reference/android/speech/tts/TextToSpeech.html#shutdown%28%29><code>shutdown()</code></a> on the <code>TextToSpeech</code> object, once you&rsquo;re done with it!</p><blockquote><p>Releases the resources used by the TextToSpeech engine. <strong>It is good practice for instance to call this method in the onDestroy() method of an Activity</strong> so the TextToSpeech engine can be cleanly stopped.</p></blockquote><p>If you fail to do so, the application will leak resources and a <code>ServiceConnectionLeaked</code> error will appear in the LogCat.</p><h2 id=conclusion>Conclusion</h2><ul><li>You&rsquo;ll need to wait for the call to <code>onInit()</code> with a status of <code>SUCCESS</code>, until you can start talking</li><li>It&rsquo;s easy to annoy users with TTS. Give them options to reduce the verbosity or to deactivate it completely and <strong>keep spoken messages short and to the point</strong></li><li>Make your application adaptive by requesting audio-focus before talking</li><li>Remember to shut down the TTS service, once you&rsquo;re done</li></ul></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2023 Lukas Knuth</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/writings>Writings</a></li><li><a href=/about>About</a></li><li><a href=/imprint>Imprint</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>